<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todos Nuestros Clientes</title>
    <link rel="stylesheet" href="/css/client_view.css" />
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body>
    <header class="banner">
      <div class="banner-content">
        <div class="nav-left">
          <img src="/assets/images/logo_shiba.png" alt="Logo" class="logo" />
          <span class="brand-name">Clínica Shiba</span>
        </div>
      </div>
    </header>

    <div class="container">
      <div class="table-header">
        <div class="title-section">
          <i data-lucide="users"></i>
          <h1>Lista de Clientes</h1>
        </div>
        <div class="search-section">
          <div class="search-container">
            <i data-lucide="search" class="search-icon"></i>
            <input
              type="text"
              placeholder="Buscar cliente..."
              class="search-input" />
          </div>
        </div>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Cédula</th>
              <th>Nombre</th>
              <th>Correo</th>
              <th>Celular</th>
              <th class="actions-header">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="cliente : ${clientes}" th:attr="data-id=${cliente.id}">
              <td th:text="${cliente.cedula}"></td>
              <td th:text="${cliente.nombre}"></td>
              <td th:text="${cliente.correo}"></td>
              <td th:text="${cliente.celular}"></td>
              <td class="actions-cell">
                <a
                  th:href="@{/cliente/update/{id}(id=${cliente.id})}"
                  class="action-button edit-button">
                  <i data-lucide="edit-2"></i>
                </a>
                <button class="action-button delete-button">
                  <i data-lucide="trash-2"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <a href="/cliente/add" class="add-button"> Agregar Cliente </a>
        <div class="pagination">
          <button class="pagination-button" disabled>
            <i data-lucide="chevron-left"></i>
          </button>
          <span class="pagination-info">Página 1 de 1</span>
          <button class="pagination-button" disabled>
            <i data-lucide="chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de confirmación -->
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <h2>Confirmar eliminación</h2>
        <p id="deleteMessage"></p>
        <div class="modal-buttons">
          <button id="confirmDelete" class="confirm-button">Aceptar</button>
          <button id="cancelDelete" class="cancel-button">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Modal de modificación -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <h2>Modificar Cliente</h2>
        <form id="editForm" method="get">
          <div class="modal-buttons">
            <button type="submit" class="confirm-button">Aceptar</button>
            <button type="button" id="cancelEdit" class="cancel-button">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Inicializar los íconos de Lucide
      lucide.createIcons();

      // Funcionalidad del modal de eliminación
      const deleteModal = document.getElementById("deleteModal");
      const deleteMessage = document.getElementById("deleteMessage");
      let currentId = null; // Cambiar a currentId para usar el ID del cliente

      function showDeleteModal(id, nombre) {
        deleteMessage.textContent = `¿Está seguro que quiere eliminar al cliente ${nombre}?`;
        currentId = id; // Guardar el ID del cliente seleccionado
        deleteModal.style.display = "flex";
      }

      // Asignar eventos a los botones de eliminar
      document.querySelectorAll(".delete-button").forEach((button) => {
        button.addEventListener("click", (e) => {
          const row = e.target.closest("tr");
          const id = row.getAttribute("data-id"); // Obtener el ID del cliente desde el atributo data-id
          const nombre = row.querySelector("td:nth-child(2)").textContent; // Obtener el nombre del cliente
          showDeleteModal(id, nombre);
        });
      });

      // Manejar la confirmación de eliminación
      document.getElementById("confirmDelete").addEventListener("click", () => {
        window.location.href = `/cliente/delete/${currentId}`; // Usar el ID del cliente en la URL
      });

      // Manejar la cancelación de eliminación
      document.getElementById("cancelDelete").addEventListener("click", () => {
        deleteModal.style.display = "none";
      });

      // Cerrar el modal de eliminación si se hace clic fuera de él
      window.addEventListener("click", (e) => {
        if (e.target === deleteModal) {
          deleteModal.style.display = "none";
        }
      });

      // Funcionalidad de modificación
      const editModal = document.getElementById("editModal");
      const editForm = document.getElementById("editForm");
      function showEditModal(id) {
        editForm.action = `/cliente/update/${id}`;
        editModal.style.display = "flex";
      }
    </script>
  </body>
</html>
